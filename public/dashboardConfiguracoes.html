<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Lagotto Dashboard </title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles/dashboard.css">
  <link rel="shortcut icon" href="assets/icon/lagotto-icon.png" type="image/x-icon">
</head>

<body>
  <div class="sidebar">
    <div class="logo"><img src="./assets/logo.png" alt="Imagem"></div>
    <div class="nav">
      <h4 id="b_usuario" style="color: white;  text-align: center;"></h4>
      <a href="dashboardAvisos.html" style="color: wheat;">
        <div class="box11">
          ‚ö†Ô∏è Avisos
        </div>
      </a>
      <a href="dashboardPlantios.html" style="color: wheat;">
        <div class="box12">
          üìä Plantios
        </div>
      </a>

      <a href="dashboardCalendario.html" style="color: wheat;">
        <div class="box14">
          üìÖ Calend√°rio
        </div>
      </a>
      <a id="config" href="dashboardConfiguracoes.html" style="color: wheat;">
        <div  class="box13">
          ‚öôÔ∏è Configura√ß√µes
        </div>
      </a>
      <a href="login_cadastro.html" style="color: wheat;">
        <div class="box15">
          ‚ùå Sair
        </div>
      </a>
    </div>
  </div>
  <div class="cadastrar">
    <h1>Cadastrar Novos Funcion√°rios</h1>
    <div class="box">
        <span style="color: wheat;">Nome:</span>
        <input type="text" id="nome_funcionario" placeholder="exemplo@exemplo.com">
        <span style="color: wheat;">Email:</span>
        <input type="text" id="email_funcionario" placeholder="exemplo@exemplo.com">
        <div id="avisoEmail" class="avisos"></div>
        <span style="color: wheat;">Senha:</span>
        <input type="password" id="senha_funcionario" placeholder="********">
        <div id="avisoSenha" class="avisos"></div>
        <button onclick="cadastrar()">Cadastrar Funcion√°rio</button>
        <div id="aviso" class="avisos"></div>
    </div>
</div>
<script src="./scripts/sessionStorage.js"></script>
<script>
    function cadastrar() {
      avisoEmail.innerHTML += ``;
      aviso.innerHTML = ``;
      const nomeInput = nome_funcionario.value;
      const emailInput = email_funcionario.value;
      const senhaInput = senha_funcionario.value;
        const fkEmpresa = sessionStorage.ID_EMPRESA;
        let indiceArroba = emailInput.indexOf('@');
        let indicePontoCom = emailInput.indexOf('.com');
        let arrobaAntesPontoCom = indiceArroba < indicePontoCom;
        let senhaPossivel = false;

        avisoEmail.innerHTML = ``;
        avisoSenha.innerHTML = ``;
        
          if(indiceArroba == -1 || indicePontoCom == -1 || !arrobaAntesPontoCom) {
              avisoEmail.innerHTML = `Insira um email v√°lido!`;
              return;
          }
          if(senhaInput.length < 8) {
              avisoSenha.innerHTML += `Sua senha deve ter ao menos 8 caracteres!<br>`;
              return;
          }
          const letraMaiuscula = new RegExp("[A-Z]");
          const letraMinuscula = new RegExp("[a-z]");
          const caracterEspecial = new RegExp(/[^a-zA-Z0-9]/);
          if(!letraMaiuscula.test(senhaInput)) {
              avisoSenha.innerHTML += `Sua senha deve conter ao menos uma letra mai√∫scula!<br>`;
              return;
          }
          if(!letraMinuscula.test(senhaInput)) {
              avisoSenha.innerHTML += `Sua senha deve conter ao menos uma letra min√∫scula!<br>`;
              return;
          }
          if(!caracterEspecial.test(senhaInput)) {
              avisoSenha.innerHTML += `Sua senha deve conter ao menos um caracter especial!`;
              return;
          }
      fetch("/usuarios/cadastrar", {
      method: "POST", 
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        nomeServer: nomeInput,
        emailServer: emailInput,
        senhaServer: senhaInput,
        fkEmpresaServer: fkEmpresa,
        ativoServer: 1,
        isAdminServer: 0
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          console.log('Dados recebidos!')
              aviso.innerHTML = `Usu√°rio Cadastrado com Sucesso!`;

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        

        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        avisoEmail.innerHTML += `Email Inv√°lido!<br>`;
      });

    return false;
    }

  </script>
  <script>
      if (sessionStorage.ADMIN != 1){
        document.getElementById('config').remove();
    }
    b_usuario.innerHTML = `Ol√° ${sessionStorage.NOME_USUARIO}</span>!`;
</script>